
#include "msp430.h"

#include "beep.h"

const int mario[]={
		660,100,
		0,150,
		660,100,
		0,300,
		660,100,
		0,300,
		510,100,
		0,100,
		660,100,
		0,300,
		770,100,
		0,550,
		380,100,
		0,575,
		510,100,
		0,450,
		380,100,
		0,400,
		320,100,
		0,500,
		440,100,
		0,300,
		480,80,
		0,330,
		450,100,
		0,150,
		430,100,
		0,300,
		380,100,
		0,200,
		660,80,
		0,200,
		760,50,
		0,150,
		860,100,
		0,300,
		700,80,
		0,150,
		760,50,
		0,350,
		660,80,
		0,300,
		520,80,
		0,150,
		580,80,
		0,150,
		480,80,
		0,500,
		510,100,
		0,450,
		380,100,
		0,400,
		320,100,
		0,500,
		440,100,
		0,300,
		480,80,
		0,330,
		450,100,
		0,150,
		430,100,
		0,300,
		380,100,
		0,200,
		660,80,
		0,200,
		760,50,
		0,150,
		860,100,
		0,300,
		700,80,
		0,150,
		760,50,
		0,350,
		660,80,
		0,300,
		520,80,
		0,150,
		580,80,
		0,150,
		480,80,
		0,500,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,150,
		0,300,
		380,100,
		0,150,
		430,100,
		0,150,
		500,100,
		0,300,
		430,100,
		0,150,
		500,100,
		0,100,
		570,100,
		0,220,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,200,
		0,300,
		1020,80,
		0,300,
		1020,80,
		0,150,
		1020,80,
		0,300,
		380,100,
		0,300,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,150,
		0,300,
		380,100,
		0,150,
		430,100,
		0,150,
		500,100,
		0,300,
		430,100,
		0,150,
		500,100,
		0,100,
		570,100,
		0,420,
		585,100,
		0,450,
		550,100,
		0,420,
		500,100,
		0,360,
		380,100,
		0,300,
		500,100,
		0,300,
		500,100,
		0,150,
		500,100,
		0,300,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,150,
		0,300,
		380,100,
		0,150,
		430,100,
		0,150,
		500,100,
		0,300,
		430,100,
		0,150,
		500,100,
		0,100,
		570,100,
		0,220,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,200,
		0,300,
		1020,80,
		0,300,
		1020,80,
		0,150,
		1020,80,
		0,300,
		380,100,
		0,300,
		500,100,
		0,300,
		760,100,
		0,100,
		720,100,
		0,150,
		680,100,
		0,150,
		620,150,
		0,300,
		650,150,
		0,300,
		380,100,
		0,150,
		430,100,
		0,150,
		500,100,
		0,300,
		430,100,
		0,150,
		500,100,
		0,100,
		570,100,
		0,420,
		585,100,
		0,450,
		550,100,
		0,420,
		500,100,
		0,360,
		380,100,
		0,300,
		500,100,
		0,300,
		500,100,
		0,150,
		500,100,
		0,300,
		500,60,
		0,150,
		500,80,
		0,300,
		500,60,
		0,350,
		500,80,
		0,150,
		580,80,
		0,350,
		660,80,
		0,150,
		500,80,
		0,300,
		430,80,
		0,150,
		380,80,
		0,600,
		500,60,
		0,150,
		500,80,
		0,300,
		500,60,
		0,350,
		500,80,
		0,150,
		580,80,
		0,150,
		660,80,
		0,550,
		870,80,
		0,325,
		760,80,
		0,600,
		500,60,
		0,150,
		500,80,
		0,300,
		500,60,
		0,350,
		500,80,
		0,150,
		580,80,
		0,350,
		660,80,
		0,150,
		500,80,
		0,300,
		430,80,
		0,150,
		380,80,
		0,600,
		660,100,
		0,150,
		660,100,
		0,300,
		660,100,
		0,300,
		510,100,
		0,100,
		660,100,
		0,300,
		770,100,
		0,550,
		380,100,
		0,575
};

const int portal[]={
		784,200,
		740,200,
		659,200,
		659,200,
		740,200,
		0,800,
		784,200,
		740,200,
		659,200,
		659,200,
		0,300,
		740,200,
		587,200,
		0,300,
		659,200,
		440,200,
		0,800,
		440,200,
		659,300,
		740,200,
		784,300,
		659,300,
		554,200,
		0,100,
		587,200,
		659,300,
		0,100,
		440,300,
		440,200,
		740,200,
		0,1000,
		784,200,
		740,200,
		659,200,
		659,200,
		740,200,
		0,800,
		784,200,
		740,200,
		659,200,
		659,200,
		0,300,
		740,200,
		587,200,
		0,300,
		659,200,
		440,200,
		0,800,
		659,300,
		740,200,
		784,300,
		659,200,
		554,300,
		587,200,
		659,400,
		0,100,
		440,200,
		587,200,
		659,200,
		698,200,
		659,200,
		587,200,
		523,200,
		0,400,
		440,200,
		466,300,
		523,300,
		698,200,
		0,100,
		659,200,
		587,200,
		587,200,
		523,200,
		0,50,
		587,200,
		523,200,
		0,50,
		523,300,
		0,50,
		523,200,
		0,200,
		440,200,
		466,300,
		523,300,
		698,200,
		0,100,
		783,200,
		698,200,
		659,250,
		587,200,
		587,200,
		659,200,
		698,300,
		0,50,
		698,300,
		0,100,
		783,200,
		880,200,
		932,200,
		932,200,
		880,200,
		0,50,
		783,300,
		698,200,
		783,200,
		880,200,
		880,200,
		783,200,
		0,50,
		698,300,
		0,100,
		587,200,
		523,200,
		587,200,
		698,200,
		698,200,
		659,300,
		0,50,
		659,200,
		739,100,
		739,400
};


void startbeep(int frequency)
{
	if(frequency==0)
	{
		TA0CTL &= ~(MC1 + MC0); // Clear MCx bits to stop timer
		return;
	}

	TA0CCR0 = (int) (1500000.0f/frequency);
	TA0CCR1 = TA0CCR0>>1; // half duty cycle

	// Start Timer_A
	TA0CTL |= MC_1; // Start timer in up mode
}

void playportal()
{
	extern unsigned long time;
	unsigned long waittime;
	unsigned int index;

	for(index=0;(index<(sizeof(portal)/sizeof(int)));index+=2)
	{
		startbeep(portal[index]);
		waittime = (unsigned long) portal[index+1];
		waittime *=1000;
		waittime += time;
		while(time<waittime)
		{
			__delay_cycles(400);
		}
	}
	stopbeep();
}

void stopbeep()
{
	// Stop Timer_A
	TA0CTL &= ~(MC1 + MC0); // Clear MCx bits to stop timer
}

void playmario()
{
	extern unsigned long time;
	unsigned long waittime;
	unsigned int index;

	for(index=0;(index<(sizeof(mario)/sizeof(int)));index+=2)
	{
		startbeep(mario[index]);
		waittime = (unsigned long) mario[index+1];
		waittime *=800;
		waittime += time;
		while(time<waittime)
		{
			__delay_cycles(400);
		}
	}
	stopbeep();
}
